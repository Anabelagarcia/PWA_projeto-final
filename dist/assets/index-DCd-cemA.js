(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const c of e)if(c.type==="childList")for(const d of c.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function o(e){const c={};return e.integrity&&(c.integrity=e.integrity),e.referrerPolicy&&(c.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?c.credentials="include":e.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(e){if(e.ep)return;e.ep=!0;const c=o(e);fetch(e.href,c)}})();const i=document.querySelector("#camera--view"),a=document.querySelector("#camera--sensor"),h=document.querySelector("#camera--trigger"),f=document.getElementById("switch-camera"),g=document.getElementById("photo-title");let u="user";const s=[],y=()=>({video:{facingMode:u},audio:!1});async function l(){return new Promise((t,r)=>{const o=indexedDB.open("cameraDB",1);o.onupgradeneeded=n=>{const e=n.target.result;e.objectStoreNames.contains("photos")||e.createObjectStore("photos",{autoIncrement:!0})},o.onsuccess=()=>t(o.result),o.onerror=()=>r(o.error)})}async function w(t){(await l()).transaction("photos","readwrite").objectStore("photos").add(t)}async function v(){const n=(await l()).transaction("photos","readonly").objectStore("photos").getAll();n.onsuccess=()=>{const e=n.result.slice(-10);s.length=0,s.push(...e),m()}}function m(){const t=document.getElementById("photo-gallery");t&&(t.innerHTML="",s.forEach(r=>{const o=document.createElement("img");o.src=r.photo,o.classList.add("photo-preview");const n=document.createElement("h3");n.innerText=`Título: ${r.title||"Sem título"}`;const e=document.createElement("div");e.classList.add("photo-container"),e.appendChild(o),e.appendChild(n),t.appendChild(e)}))}function p(){navigator.mediaDevices.getUserMedia(y()).then(t=>{i.srcObject=t}).catch(t=>console.error("Ocorreu um erro ao acessar a câmera:",t))}h.onclick=async function(){const t=g.value.trim();if(!t){alert("Por favor, insira um título antes de tirar a foto.");return}a.width=i.videoWidth,a.height=i.videoHeight,a.getContext("2d").drawImage(i,0,0);const r=a.toDataURL("image/webp"),o={title:t,photo:r,timestamp:new Date().toISOString()};s.push(o),s.length>3&&s.shift(),await w(o),m()};f.onclick=function(){u=u==="user"?"environment":"user",p()};window.addEventListener("load",()=>{p(),v()});
